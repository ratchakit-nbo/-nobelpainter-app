<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nobel Pronunciation Lab - By ‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</title>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-body: #0a0a0c;
            --card-bg: #16161a;
            --accent-purple: #8b5cf6;
            --accent-cyan: #06b6d4;
            --success-neon: #10b981;
            --danger-neon: #f43f5e;
            --text-main: #f8fafc;
            --text-dim: #94a3b8;
            --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Sarabun', sans-serif;
            background: var(--bg-body);
            background-image: 
                radial-gradient(at 0% 0%, rgba(139, 92, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(6, 182, 212, 0.15) 0px, transparent 50%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 15px;
            color: var(--text-main);
        }

        .container {
            background: var(--card-bg);
            border-radius: 32px;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border);
            overflow: hidden;
            position: relative;
        }

        .setup-section {
            background: var(--glass);
            padding: 1.5rem;
            border-bottom: 1px solid var(--border);
        }

        .label-text {
            font-size: 0.75rem;
            font-weight: 700;
            color: var(--accent-purple);
            letter-spacing: 0.1rem;
            margin-bottom: 0.75rem;
            display: block;
            text-transform: uppercase;
        }

        .input-group {
            display: flex;
            gap: 10px;
            background: rgba(0,0,0,0.2);
            padding: 6px;
            border-radius: 16px;
            border: 1px solid var(--border);
        }

        input[type="text"] {
            flex: 1;
            padding: 10px 12px;
            border: none;
            background: transparent;
            color: white;
            font-size: 1rem;
            outline: none;
        }

        .btn-set {
            background: var(--accent-purple);
            color: white;
            border: none;
            padding: 0 18px;
            border-radius: 12px;
            cursor: pointer;
            font-weight: 700;
        }

        .target-box {
            padding: 2.5rem 1rem;
            text-align: center;
        }

        .target-display {
            font-size: 3.5rem;
            font-weight: 800;
            background: linear-gradient(to bottom right, #fff, #94a3b8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 1rem;
        }

        .control-row {
            display: flex;
            justify-content: center;
            gap: 16px;
        }

        .btn-round {
            background: var(--glass);
            border: 1px solid var(--border);
            border-radius: 50%;
            width: 56px;
            height: 56px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: white;
        }

        .status-area {
            margin: 1.5rem auto;
            position: relative;
            width: 120px;
            height: 120px;
        }

        .status-circle {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 2px solid var(--border);
            display: flex;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle, rgba(255,255,255,0.05) 0%, transparent 70%);
            font-size: 1.2rem;
            font-weight: 700;
        }

        .pulse-active {
            border-color: var(--accent-cyan);
            animation: pulse-border 1.5s infinite;
        }

        @keyframes pulse-border {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        .btn-main {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-cyan));
            color: white;
            border: none;
            padding: 1.2rem;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            width: calc(100% - 48px);
            margin: 0 24px 1.5rem 24px;
            box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.4);
        }

        .btn-main:disabled { opacity: 0.4; filter: grayscale(1); }

        .transcript-box {
            margin: 0 24px 1.5rem 24px;
            font-size: 0.85rem;
            color: var(--text-dim);
            padding: 16px;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            min-height: 24px;
            border: 1px solid var(--border);
            text-align: center;
        }

        .home-btn {
            display: block;
            text-align: center;
            text-decoration: none;
            color: var(--text-dim);
            font-size: 0.8rem;
            margin-bottom: 2rem;
        }

        .credit {
            background: var(--glass);
            padding: 1rem;
            font-size: 0.7rem;
            color: #444;
            letter-spacing: 1.5px;
            text-align: center;
        }

        .success-text { color: var(--success-neon) !important; border-color: var(--success-neon) !important; }
        .danger-text { color: var(--danger-neon) !important; border-color: var(--danger-neon) !important; }

    </style>
</head>
<body>

<div class="container">
    <div class="setup-section">
        <span class="label-text">VOCABULARY SETTINGS</span>
        <div class="input-group">
            <input type="text" id="wordInput" placeholder="Enter word..." value="‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ">
            <button class="btn-set" onclick="updateTarget()">SET</button>
        </div>
    </div>

    <div class="target-box">
        <div class="target-display" id="targetWord">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ</div>
        <div class="control-row">
            <button class="btn-round" onclick="playAiVoice(targetWord.innerText)">üîä</button>
            <button id="muteBtn" class="btn-round" onclick="toggleMute()">üé§</button>
        </div>
    </div>
    
    <div class="status-area">
        <div class="status-circle" id="statusBox">READY</div>
    </div>

    <button id="startBtn" class="btn-main">TAP TO SPEAK</button>
    
    <div class="transcript-box" id="transcript">Waiting for your voice...</div>

    <a href="https://ratchakit-nbo.github.io/-nobelpainter-app/game-nobel.html" class="home-btn">‚Üê BACK TO HOME</a>

    <div class="credit">SYSTEM BY <strong>‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</strong></div>
</div>

<script>
    const wordInput = document.getElementById('wordInput');
    const targetWord = document.getElementById('targetWord');
    const startBtn = document.getElementById('startBtn');
    const transcriptDisplay = document.getElementById('transcript');
    const statusBox = document.getElementById('statusBox');

    let mediaRecorder;
    let audioChunks = [];
    let recognition;
    let lastResult = "";
    let audioContext;
    let analyser;

    // ‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏î‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
    async function setupMic() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ 
                audio: { echoCancellation: true, noiseSuppression: true, autoGainControl: true } 
            });
            
            audioContext = new (window.AudioContext || window.webkitAudioContext)();
            analyser = audioContext.createAnalyser();
            const source = audioContext.createMediaStreamSource(stream);
            source.connect(analyser);
            
            mediaRecorder = new MediaRecorder(stream);
            mediaRecorder.ondataavailable = (e) => { if (e.data.size > 0) audioChunks.push(e.data); };
            
            mediaRecorder.onstop = () => {
                if (audioChunks.length > 0) {
                    const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                    const audioUrl = URL.createObjectURL(audioBlob);
                    const userVoice = new Audio(audioUrl);
                    
                    statusBox.innerText = "CHECKING";
                    statusBox.className = "status-circle";
                    
                    userVoice.play();
                    userVoice.onended = () => {
                        // ‡∏´‡∏ô‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤ Recognition ‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß
                        setTimeout(() => {
                            checkStrictMatch(targetWord.innerText, lastResult);
                        }, 600);
                    };
                }
            };
        } catch (err) { transcriptDisplay.innerText = "Please enable microphone access"; }
    }
    setupMic();

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (SpeechRecognition) {
        recognition = new SpeechRecognition();
        recognition.lang = 'th-TH';
        recognition.interimResults = false;
        recognition.continuous = false;

        recognition.onstart = () => {
            statusBox.innerText = "LISTENING";
            statusBox.className = "status-circle pulse-active";
            startBtn.disabled = true;
            audioChunks = [];
            lastResult = ""; 
            if(mediaRecorder && mediaRecorder.state === 'inactive') mediaRecorder.start();
            
            // ‡∏ï‡∏£‡∏ß‡∏à‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏á‡∏Ç‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏π‡∏î
            checkVolume();
        };

        recognition.onresult = (event) => {
            // ‡∏à‡∏±‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡πÅ‡∏£‡∏Å‡∏ó‡∏µ‡πà‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
            lastResult = event.results[0][0].transcript;
            transcriptDisplay.innerHTML = `You said: <b style="color:var(--accent-cyan)">${lastResult}</b>`;
        };

        recognition.onend = () => {
            statusBox.classList.remove('pulse-active');
            setTimeout(() => {
                if(mediaRecorder && mediaRecorder.state === 'recording') mediaRecorder.stop();
            }, 200);
            startBtn.disabled = false;
        };
    }

    function checkVolume() {
        if (!analyser) return;
        const dataArray = new Uint8Array(analyser.frequencyBinCount);
        analyser.getByteFrequencyData(dataArray);
        let values = 0;
        for (let i = 0; i < dataArray.length; i++) { values += dataArray[i]; }
        let average = values / dataArray.length;
        
        // ‡∏ñ‡πâ‡∏≤‡∏Ñ‡πà‡∏≤‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏á‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (average) ‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏ó‡∏£‡∏Å‡πÄ‡∏ö‡∏≤‡πÜ) Recognition ‡∏°‡∏±‡∏Å‡∏à‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡∏ß‡πà‡∏≤‡∏á
        if (mediaRecorder.state === 'recording') {
            requestAnimationFrame(checkVolume);
        }
    }

    function playAiVoice(text) {
        window.speechSynthesis.cancel(); 
        const msg = new SpeechSynthesisUtterance(text);
        msg.lang = 'th-TH';
        msg.rate = 1.0;
        msg.volume = 1.0; // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏î‡∏±‡∏á AI ‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î
        window.speechSynthesis.speak(msg);
    }

    function updateTarget() {
        targetWord.innerText = wordInput.value.trim() || "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ";
        statusBox.innerText = "READY";
        statusBox.className = "status-circle";
        transcriptDisplay.innerText = "Waiting for your voice...";
    }

    startBtn.onclick = () => { 
        if (recognition) {
            if (audioContext && audioContext.state === 'suspended') audioContext.resume();
            try { recognition.start(); } catch(e) { recognition.stop(); }
        }
    };

    function checkStrictMatch(target, spoken) {
        const cleanSpoken = spoken.trim().replace(/\s+/g, '');
        const cleanTarget = target.trim().replace(/\s+/g, '');
        
        statusBox.className = "status-circle";

        // ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏û‡∏π‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏Å‡∏±‡∏ô‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÅ‡∏ó‡∏£‡∏Å‡∏ó‡∏µ‡πà‡πÄ‡∏á‡∏µ‡∏¢‡∏ö‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ)
        if (cleanSpoken === "") {
            statusBox.innerText = "‡∏ú‡∏¥‡∏î";
            statusBox.classList.add('danger-text');
            playAiVoice("‡∏Ñ‡∏∏‡∏ì‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
            return;
        }

        // ‡πÄ‡∏ä‡πá‡∏Å‡∏ß‡πà‡∏≤‡∏Ñ‡∏≥‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏õ‡∏£‡∏∞‡πÇ‡∏¢‡∏Ñ‡∏ó‡∏µ‡πà‡∏î‡∏±‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà
        const isMatch = cleanSpoken.includes(cleanTarget);
        
        if (isMatch) {
            statusBox.innerText = "‡∏ñ‡∏π‡∏Å";
            statusBox.classList.add('success-text');
            playAiVoice("‡∏Ñ‡∏∏‡∏ì‡∏û‡∏π‡∏î‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
        } else {
            statusBox.innerText = "‡∏ú‡∏¥‡∏î";
            statusBox.classList.add('danger-text');
            playAiVoice("‡∏Ñ‡∏∏‡∏ì‡∏û‡∏π‡∏î‡πÑ‡∏°‡πà‡∏ä‡∏±‡∏î ‡∏•‡∏≠‡∏á‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á");
        }
    }
</script>
</body>
</html>
