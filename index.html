<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painter - WiFi Host</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; margin: 0; text-align: center; }
        #status-bar { background: #333; padding: 15px; border-bottom: 2px solid #444; }
        .id-label { background: #007bff; padding: 5px 15px; border-radius: 5px; font-weight: bold; font-size: 20px; }
        canvas { background: white; cursor: crosshair; touch-action: none; margin-top: 20px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
        .btn { padding: 12px 25px; border-radius: 8px; border: none; cursor: pointer; font-weight: bold; margin: 5px; }
        .btn-success { background: #28a745; color: white; font-size: 18px; }
    </style>
</head>
<body>

    <div id="status-bar">
        <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b id="conn-status" style="color:#ffc107;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ç‡∏≠ ID...</b></div>
        <div style="margin-top:10px;">ID ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì: <span class="id-label" id="my-id">---</span></div>
    </div>

    <select id="template" style="padding:10px; margin: 20px 0;">
        <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö --</option>
        <option value="üê∂">‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</option><option value="üê±">‡πÅ‡∏°‡∏ß</option><option value="üê∞">‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢</option>
    </select>
    <button class="btn" onclick="clearCanvas()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏≠</button>

    <div id="canvas-wrap">
        <canvas id="paintCanvas" width="600" height="600"></canvas>
    </div>

    <button class="btn btn-success" id="send-btn" style="display:none; width: 80%;" onclick="sendData()">‡∏™‡πà‡∏á‡πÑ‡∏õ‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à üöÄ</button>

    <script>
        const canvas = document.getElementById('paintCanvas'), ctx = canvas.getContext('2d');
        let conn = null, drawing = false;

        // ‡πÉ‡∏ä‡πâ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ STUN/TURN ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏à‡∏≤‡∏∞‡∏ó‡∏∞‡∏•‡∏∏ 4G ‡πÑ‡∏î‡πâ
        const peer = new Peer({
            config: {
                'iceServers': [
                    { 'urls': 'stun:stun.l.google.com:19302' },
                    { 'urls': 'stun:stun1.l.google.com:19302' },
                    { 'urls': 'stun:stun2.l.google.com:19302' }
                ]
            }
        });

        peer.on('open', id => {
            document.getElementById('my-id').innerText = id;
            document.getElementById('conn-status').innerText = "‡∏£‡∏≠‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...";
        });

        peer.on('connection', c => {
            conn = c;
            document.getElementById('conn-status').innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ";
            document.getElementById('conn-status').style.color = "#28a745";
            
            conn.on('data', data => {
                if(data.score) alert("‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡πâ‡∏ß: " + data.score);
            });
        });

        // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏î
        ctx.fillStyle = "white"; ctx.fillRect(0,0,600,600);
        canvas.onmousedown = () => drawing = true;
        window.onmouseup = () => { drawing = false; ctx.beginPath(); };
        canvas.onmousemove = (e) => {
            if(!drawing) return;
            ctx.lineWidth = 10; ctx.lineCap = 'round'; ctx.strokeStyle = '#000';
            ctx.lineTo(e.offsetX, e.offsetY); ctx.stroke();
        };

        document.getElementById('template').onchange = function() {
            clearCanvas();
            if(this.value) {
                ctx.save(); ctx.textAlign="center"; ctx.textBaseline="middle"; ctx.font="400px Arial";
                ctx.fillStyle="rgba(0,0,0,0.05)"; ctx.fillText(this.value, 300, 300); ctx.restore();
                document.getElementById('send-btn').style.display = 'inline-block';
            }
        };

        function clearCanvas() { ctx.fillStyle = "white"; ctx.fillRect(0,0,600,600); }
        function sendData() {
            if(conn && conn.open) {
                conn.send({ img: canvas.toDataURL('image/jpeg', 0.5), char: document.getElementById('template').value });
                alert("‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            } else { alert("‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏≠‡∏¢‡∏π‡πà!"); }
        }
    </script>
</body>
</html>
