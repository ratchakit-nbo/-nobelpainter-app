<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Painter - By ‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --accent: #00f2fe; --neon: #711cff; --bg: #0b0e14; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; overflow: hidden; display: flex; height: 100vh; width: 100%; position: fixed; }
        #toolbar { width: 90px; background: rgba(20, 25, 35, 0.95); border-right: 1px solid var(--neon); display: flex; flex-direction: column; align-items: center; padding: 10px 0; z-index: 100; gap: 8px; overflow-y: auto; }
        .tool-btn { width: 50px; height: 50px; background: #1a1f29; border: 1px solid #333; border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; flex-shrink: 0; }
        .tool-btn.active { background: var(--accent); color: #000; box-shadow: 0 0 15px var(--accent); }
        #workspace { flex-grow: 1; position: relative; background: #1a1f29; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        canvas { display: block; background: #fff; cursor: crosshair; touch-action: none; z-index: 1; }
        #template-overlay { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 450px; opacity: 0.15; pointer-events: none; z-index: 10; user-select: none; display: flex; align-items: center; justify-content: center; width: 100%; height: 100%; }
        #top-info { position: absolute; top: 15px; left: 15px; padding: 10px 20px; background: rgba(0,0,0,0.8); border-radius: 50px; border: 1px solid var(--accent); display: flex; gap: 15px; font-size: 14px; z-index: 20; }
        #mini-preview-box { position: absolute; top: 15px; right: 15px; width: 65px; height: 65px; background: rgba(0,0,0,0.6); border: 2px solid var(--accent); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20; }
        #color-bar { width: 60px; background: rgba(20, 25, 35, 0.8); display: flex; flex-direction: column; align-items: center; padding: 15px 0; gap: 8px; overflow-y: auto; }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        #right-panel { width: 100px; background: rgba(20, 25, 35, 0.9); border-left: 1px solid #333; display: flex; flex-direction: column; z-index: 100; }
        #template-library { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; align-items: center; gap: 15px; padding: 15px 0; }
        .lib-item { font-size: 40px; cursor: pointer; transition: 0.2s; padding: 5px; }
        #btn-send { position: fixed; bottom: 30px; right: 120px; background: linear-gradient(45deg, #28a745, #1ed760); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 18px; cursor: pointer; z-index: 90; }
        #score-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; color: #000; padding: 40px; border-radius: 40px; text-align: center; z-index: 1000; border: 5px solid var(--accent); }
    </style>
</head>
<body>
    <audio id="applause-sound" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
    <div id="score-popup"><h2 style="margin:0;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2><span id="score-num" style="font-size: 120px; font-weight: 900; color: var(--neon);">0</span><br><button onclick="document.getElementById('score-popup').style.display='none'" style="padding:15px 40px; border-radius:50px; background:var(--neon); color:white; border:none; font-size:20px; cursor:pointer;">‡∏ß‡∏≤‡∏î‡∏ï‡πà‡∏≠!</button></div>
    <div id="toolbar">
        <button class="tool-btn active" onclick="setMode('brush', this)">‚úèÔ∏è</button>
        <button class="tool-btn" onclick="setMode('eraser', this)">üßΩ</button>
        <button class="tool-btn" onclick="setMode('fill', this)">ü™£</button>
        <button class="tool-btn" onclick="setMode('rect', this)">‚¨ú</button>
        <button class="tool-btn" onclick="setMode('circle', this)">‚≠ï</button>
        <button class="tool-btn" onclick="setMode('tri', this)">üî∫</button>
        <input type="range" id="brush-size" min="1" max="50" value="5" style="width:70%; accent-color:var(--accent); margin-top:5px;">
        <button class="tool-btn" onclick="undo()" style="margin-top:auto;">‚Ü©Ô∏è</button>
        <button class="tool-btn" onclick="clearCanvas()">üóëÔ∏è</button>
    </div>
    <div id="workspace">
        <div id="top-info"><div style="color:var(--accent); font-weight:bold; margin-right:10px;">‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</div><div>ID: <span id="my-id" style="color:var(--accent); font-weight:bold;">...</span></div></div>
        <div id="mini-preview-box"><div id="mini-preview" style="font-size:35px;">üñºÔ∏è</div></div>
        <div id="template-overlay"></div>
        <canvas id="paintCanvas"></canvas>
    </div>
    <div id="color-bar"></div>
    <div id="right-panel"><div id="template-library"></div></div>
    <button id="btn-send" onclick="sendData()">‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô üöÄ</button>
    <script>
        const canvas = document.getElementById('paintCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const templateOverlay = document.getElementById('template-overlay');
        const miniPreview = document.getElementById('mini-preview');
        let currentConn = null, drawing = false, mode = 'brush', undoStack = [], currentColor = '#000000', startX, startY, snapshot;

        const peerId = Math.floor(100000 + Math.random() * 900000).toString();
        const peer = new Peer(peerId);
        peer.on('open', id => document.getElementById('my-id').innerText = id);
        peer.on('connection', conn => {
            currentConn = conn;
            conn.on('data', data => {
                if(data.score) {
                    document.getElementById('score-num').innerText = data.score;
                    document.getElementById('score-popup').style.display = 'block';
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                    document.getElementById('applause-sound').play().catch(()=>{});
                }
            });
        });
        function sendData() {
            if (currentConn && currentConn.open) {
                const imgData = canvas.toDataURL('image/jpeg', 0.4); 
                currentConn.send({ img: imgData, char: miniPreview.innerText });
                alert("‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏õ‡∏ï‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß!");
            } else { alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à!"); }
        }
        function initCanvas() { canvas.width = window.innerWidth - 250; canvas.height = window.innerHeight; ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height); saveState(); }
        window.onresize = initCanvas; window.onload = initCanvas;
        const items = ["üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üêØ","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üê§","ü¶Ü","ü¶Ö","ü¶â","üê¥","ü¶Ñ","üê¢","üå∏","üåª","üåπ","üå∑","üåº","üå∫","üçÄ","üåø","üåµ","üéÑ","üéã","üçÉ","üçÇ","üçÅ","üçÑ","üåæ","üíê","üèµÔ∏è","ü•Ä","üíÆ","ü™¥","üåµ","üçÄ","ü™¥","üåª"];
        const lib = document.getElementById('template-library');
        items.forEach(t => { const el = document.createElement('div'); el.className = 'lib-item'; el.innerText = t; el.onclick = () => { templateOverlay.innerText = t; miniPreview.innerText = t; }; lib.appendChild(el); });
        const colors = ['#000000','#ffffff','#ff0000','#00ff00','#0000ff','#ffff00','#ff00ff','#00ffff','#ff9900','#663300'];
        colors.forEach(c => { const div = document.createElement('div'); div.className = 'color-dot'; div.style.background = c; div.onclick = () => { currentColor = c; document.querySelectorAll('.color-dot').forEach(d=>d.style.borderColor='transparent'); div.style.borderColor = 'white'; }; document.getElementById('color-bar').appendChild(div); });
        function setMode(m, btn) { mode = m; document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
        function floodFill(x, y, fillHex) {
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const r = parseInt(fillHex.slice(1, 3), 16), g = parseInt(fillHex.slice(3, 5), 16), b = parseInt(fillHex.slice(5, 7), 16);
            const startIdx = (y * canvas.width + x) * 4;
            const sR = imageData.data[startIdx], sG = imageData.data[startIdx+1], sB = imageData.data[startIdx+2];
            if (sR === r && sG === g && sB === b) return;
            const queue = [x, y];
            while (queue.length > 0) {
                const curY = queue.pop(), curX = queue.pop();
                const idx = (curY * canvas.width + curX) * 4;
                if (imageData.data[idx] === sR && imageData.data[idx+1] === sG && imageData.data[idx+2] === sB) {
                    imageData.data[idx] = r; imageData.data[idx+1] = g; imageData.data[idx+2] = b; imageData.data[idx+3] = 255;
                    if (curX > 0) queue.push(curX - 1, curY);
                    if (curX < canvas.width - 1) queue.push(curX + 1, curY);
                    if (curY > 0) queue.push(curX, curY - 1);
                    if (curY < canvas.height - 1) queue.push(curX, curY + 1);
                }
            }
            ctx.putImageData(imageData, 0, 0);
        }
        canvas.onpointerdown = (e) => { drawing = true; startX = Math.round(e.offsetX); startY = Math.round(e.offsetY); if(mode === 'fill') { floodFill(startX, startY, currentColor); drawing = false; saveState(); return; } snapshot = ctx.getImageData(0,0,canvas.width,canvas.height); ctx.beginPath(); ctx.strokeStyle = mode === 'eraser' ? 'white' : currentColor; ctx.lineWidth = document.getElementById('brush-size').value; ctx.lineCap = 'round'; ctx.lineJoin = 'round'; };
        canvas.onpointermove = (e) => { if(!drawing) return; const x = e.offsetX, y = e.offsetY; if (mode === 'brush' || mode === 'eraser') { ctx.lineTo(x, y); ctx.stroke(); } else { ctx.putImageData(snapshot, 0, 0); ctx.beginPath(); if (mode === 'rect') ctx.strokeRect(startX, startY, x - startX, y - startY); else if (mode === 'circle') { const r = Math.sqrt(Math.pow(x-startX,2) + Math.pow(y-startY,2)); ctx.arc(startX, startY, r, 0, Math.PI*2); ctx.stroke(); } else if (mode === 'tri') { ctx.moveTo(startX + (x - startX) / 2, startY); ctx.lineTo(startX, y); ctx.lineTo(x, y); ctx.closePath(); ctx.stroke(); } } };
        canvas.onpointerup = () => { if(drawing) { drawing = false; saveState(); } };
        function clearCanvas() { ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height); saveState(); }
        function saveState() { undoStack.push(ctx.getImageData(0,0,canvas.width,canvas.height)); if(undoStack.length > 20) undoStack.shift(); }
        function undo() { if(undoStack.length > 1) { undoStack.pop(); ctx.putImageData(undoStack[undoStack.length-1], 0,0); } }
    </script>
</body>
</html>
