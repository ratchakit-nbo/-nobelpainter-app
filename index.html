<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painter PC - Auto Gen ID</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        :root { --primary: #007bff; --success: #28a745; --bg: #1a1a1a; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; text-align: center; }
        #status-bar { background: #333; padding: 15px; border-bottom: 2px solid #444; display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; }
        .id-badge { background: var(--primary); padding: 8px 20px; border-radius: 10px; font-weight: bold; font-size: 1.5rem; letter-spacing: 3px; color: #fff; box-shadow: 0 0 10px rgba(0,123,255,0.5); }
        #canvas-wrap { margin-top: 20px; position: relative; display: inline-block; }
        canvas { background: white; cursor: crosshair; touch-action: none; box-shadow: 0 0 30px rgba(0,0,0,0.5); border-radius: 5px; }
        .controls { margin-top: 15px; display: flex; justify-content: center; gap: 10px; }
        select, button { padding: 10px 20px; border-radius: 8px; border: none; font-size: 16px; cursor: pointer; }
        .btn-send { background: var(--success); color: white; width: 600px; max-width: 90%; margin-top: 15px; font-size: 20px; font-weight: bold; display: none; }
    </style>
</head>
<body>

    <div id="status-bar">
        <div>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b id="conn-status" style="color:#ffc107;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏´‡∏±‡∏™...</b></div>
        <div>‡∏£‡∏´‡∏±‡∏™‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ (6 ‡∏´‡∏•‡∏±‡∏Å): <span class="id-badge" id="my-id">------</span></div>
    </div>

    <div class="controls">
        <select id="template">
            <option value="">-- ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏†‡∏≤‡∏û‡∏ï‡πâ‡∏ô‡πÅ‡∏ö‡∏ö --</option>
            <option value="üê∂">‡∏™‡∏∏‡∏ô‡∏±‡∏Ç</option><option value="üê±">‡πÅ‡∏°‡∏ß</option><option value="üê∞">‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢</option>
            <option value="ü¶ä">‡∏à‡∏¥‡πâ‡∏á‡∏à‡∏≠‡∏Å</option><option value="üêº">‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤</option><option value="ü¶Å">‡∏™‡∏¥‡∏á‡πÇ‡∏ï</option>
        </select>
        <button onclick="undo()">‚Ü©Ô∏è ‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö</button>
        <button onclick="clearCanvas()">üóëÔ∏è ‡∏•‡πâ‡∏≤‡∏á‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</button>
    </div>

    <div id="canvas-wrap">
        <canvas id="paintCanvas" width="600" height="600"></canvas>
    </div>

    <center><button class="btn-send" id="send-btn" onclick="sendData()">‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï üöÄ</button></center>

    <script>
        const canvas = document.getElementById('paintCanvas'), ctx = canvas.getContext('2d');
        let conn = null, drawing = false, undoStack = [];

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç 6 ‡∏´‡∏•‡∏±‡∏Å
        const randomID = Math.floor(100000 + Math.random() * 900000).toString();

        const peer = new Peer(randomID, {
            config: { 'iceServers': [{ 'urls': 'stun:stun.l.google.com:19302' }, { 'urls': 'stun:stun1.l.google.com:19302' }] }
        });

        peer.on('open', id => {
            document.getElementById('my-id').innerText = id;
            document.getElementById('conn-status').innerText = "‡∏£‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...";
        });

        peer.on('connection', c => {
            conn = c;
            document.getElementById('conn-status').innerText = "‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‚úÖ";
            document.getElementById('conn-status').style.color = "#28a745";
            conn.on('data', data => { if(data.score) alert("‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡πÅ‡∏•‡πâ‡∏ß: " + data.score); });
            conn.on('close', () => {
                document.getElementById('conn-status').innerText = "‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏´‡∏•‡∏∏‡∏î ‚ùå";
                document.getElementById('conn-status').style.color = "#ff4d4d";
            });
        });

        // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ß‡∏≤‡∏î
        ctx.fillStyle = "white"; ctx.fillRect(0,0,600,600);
        saveState();

        function getPos(e) {
            const r = canvas.getBoundingClientRect();
            const clientX = e.clientX || (e.touches ? e.touches[0].clientX : 0);
            const clientY = e.clientY || (e.touches ? e.touches[0].clientY : 0);
            return { x: clientX - r.left, y: clientY - r.top };
        }

        canvas.onmousedown = (e) => { drawing = true; const p = getPos(e); ctx.beginPath(); ctx.moveTo(p.x, p.y); };
        window.onmousemove = (e) => {
            if(!drawing) return;
            const p = getPos(e);
            ctx.lineWidth = 10; ctx.lineCap = 'round'; ctx.strokeStyle = '#000';
            ctx.lineTo(p.x, p.y); ctx.stroke();
        };
        window.onmouseup = () => { if(drawing) { drawing = false; saveState(); } };

        document.getElementById('template').onchange = function() {
            clearCanvas();
            if(this.value) {
                ctx.save(); ctx.textAlign="center"; ctx.textBaseline="middle"; ctx.font="400px Arial";
                ctx.fillStyle="rgba(0,0,0,0.05)"; ctx.fillText(this.value, 300, 300); ctx.restore();
                document.getElementById('send-btn').style.display = 'block';
            }
        };

        function saveState() { undoStack.push(ctx.getImageData(0,0,600,600)); if(undoStack.length > 20) undoStack.shift(); }
        function undo() { if(undoStack.length > 1) { undoStack.pop(); ctx.putImageData(undoStack[undoStack.length-1], 0,0); } }
        function clearCanvas() { ctx.fillStyle = "white"; ctx.fillRect(0,0,600,600); document.getElementById('template').onchange(); }

        function sendData() {
            if(conn && conn.open) {
                conn.send({ img: canvas.toDataURL('image/jpeg', 0.5), char: document.getElementById('template').value });
                alert("‡∏™‡πà‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÅ‡∏•‡πâ‡∏ß!");
            } else { alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö‡πÅ‡∏ó‡πá‡∏ö‡πÄ‡∏•‡πá‡∏ï!"); }
        }
    </script>
</body>
</html>
