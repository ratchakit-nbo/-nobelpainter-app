<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Cyber Painter - By ‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</title>
    <script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root { --accent: #00f2fe; --neon: #711cff; --bg: #0b0e14; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; margin: 0; overflow: hidden; display: flex; height: 100vh; width: 100%; position: fixed; }
        
        #toolbar { width: 90px; background: rgba(20, 25, 35, 0.95); border-right: 1px solid var(--neon); display: flex; flex-direction: column; align-items: center; padding: 10px 0; z-index: 100; gap: 10px; }
        .tool-btn { width: 55px; height: 55px; background: #1a1f29; border: 1px solid #333; border-radius: 12px; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 22px; }
        .tool-btn.active { background: var(--accent); color: #000; box-shadow: 0 0 15px var(--accent); }
        
        /* Workspace Setup */
        #workspace { flex-grow: 1; position: relative; background: #1a1f29; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        canvas { display: block; background: #fff; cursor: crosshair; touch-action: none; z-index: 1; }
        
        /* Layer ‡∏£‡∏π‡∏õ‡πÅ‡∏°‡πà‡πÅ‡∏ö‡∏ö‡∏ß‡∏≤‡∏î‡∏ó‡∏±‡∏ö - ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏ï‡πà‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏î‡πâ */
        #template-overlay { 
            position: absolute; 
            top: 50%; left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 450px; 
            opacity: 0.15; /* ‡∏õ‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≤‡∏á‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ */
            pointer-events: none; /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç: ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏ß‡∏≤‡∏î‡∏£‡∏π‡∏õ‡∏ó‡∏∞‡∏•‡∏∏‡∏ú‡πà‡∏≤‡∏ô‡∏£‡∏π‡∏õ‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ */
            z-index: 10; /* ‡πÉ‡∏´‡πâ‡∏≠‡∏¢‡∏π‡πà‡πÄ‡∏´‡∏ô‡∏∑‡∏≠ Canvas */
            user-select: none;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            height: 100%;
        }

        #top-info { position: absolute; top: 15px; left: 15px; padding: 10px 20px; background: rgba(0,0,0,0.8); border-radius: 50px; border: 1px solid var(--accent); display: flex; gap: 15px; font-size: 14px; z-index: 20; }
        #mini-preview-box { position: absolute; top: 15px; right: 15px; width: 65px; height: 65px; background: rgba(0,0,0,0.6); border: 2px solid var(--accent); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20; }
        #mini-preview { font-size: 35px; }

        #color-bar { width: 60px; background: rgba(20, 25, 35, 0.8); display: flex; flex-direction: column; align-items: center; padding: 15px 0; gap: 8px; overflow-y: auto; }
        .color-dot { width: 35px; height: 35px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; }
        
        #right-panel { width: 100px; background: rgba(20, 25, 35, 0.9); border-left: 1px solid #333; display: flex; flex-direction: column; z-index: 100; }
        #template-library { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; align-items: center; gap: 15px; padding: 15px 0; }
        .lib-item { font-size: 40px; cursor: pointer; transition: 0.2s; padding: 5px; }
        .lib-item:hover { transform: scale(1.2); background: rgba(255,255,255,0.1); border-radius: 10px; }

        #btn-send { position: fixed; bottom: 30px; right: 120px; background: linear-gradient(45deg, #28a745, #1ed760); color: white; border: none; padding: 15px 40px; border-radius: 50px; font-weight: bold; font-size: 18px; cursor: pointer; z-index: 90; }
        #score-popup { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #fff; color: #000; padding: 40px; border-radius: 40px; text-align: center; z-index: 1000; border: 5px solid var(--accent); }
    </style>
</head>
<body>
    <audio id="applause-sound" src="https://assets.mixkit.co/active_storage/sfx/2013/2013-preview.mp3"></audio>
    <div id="score-popup"><h2 style="margin:0;">‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</h2><span id="score-num" style="font-size: 120px; font-weight: 900; color: var(--neon);">0</span><br><button onclick="document.getElementById('score-popup').style.display='none'" style="padding:15px 40px; border-radius:50px; background:var(--neon); color:white; border:none; font-size:20px; cursor:pointer;">‡∏ß‡∏≤‡∏î‡∏ï‡πà‡∏≠!</button></div>

    <div id="toolbar">
        <button class="tool-btn active" onclick="setMode('brush', this)">‚úèÔ∏è</button>
        <button class="tool-btn" onclick="setMode('eraser', this)">üßΩ</button>
        <button class="tool-btn" onclick="setMode('fill', this)">ü™£</button>
        <input type="range" id="brush-size" min="1" max="50" value="5" style="width:70%; accent-color:var(--accent);">
        <button class="tool-btn" onclick="undo()">‚Ü©Ô∏è</button>
        <button class="tool-btn" onclick="clearCanvas()">üóëÔ∏è</button>
    </div>

    <div id="workspace">
        <div id="top-info">
            <div style="color:var(--accent); font-weight:bold; margin-right:10px;">‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</div>
            <div>ID: <span id="my-id" style="color:var(--accent); font-weight:bold;">...</span></div>
        </div>
        
        <div id="mini-preview-box">
            <span style="font-size:8px; color:var(--accent)">‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á</span>
            <div id="mini-preview">üñºÔ∏è</div>
        </div>

        <div id="template-overlay"></div>

        <canvas id="paintCanvas"></canvas>
    </div>

    <div id="color-bar"></div>

    <div id="right-panel">
        <div style="text-align:center; font-size:12px; padding:10px 0; color:var(--accent); font-weight:bold; border-bottom:1px solid #333;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏π‡∏õ</div>
        <div id="template-library"></div>
    </div>

    <button id="btn-send" onclick="sendData()">‡∏™‡πà‡∏á‡∏á‡∏≤‡∏ô üöÄ</button>

    <script>
        const canvas = document.getElementById('paintCanvas');
        const ctx = canvas.getContext('2d', { willReadFrequently: true });
        const templateOverlay = document.getElementById('template-overlay');
        const miniPreview = document.getElementById('mini-preview');
        let currentConn = null, drawing = false, mode = 'brush', undoStack = [], currentColor = '#000000';

        // PeerJS Connection
        const peerId = Math.floor(100000 + Math.random() * 900000).toString();
        const peer = new Peer(peerId);
        peer.on('open', id => document.getElementById('my-id').innerText = id);
        peer.on('connection', conn => {
            currentConn = conn;
            conn.on('data', data => {
                if(data.score) {
                    document.getElementById('score-num').innerText = data.score;
                    document.getElementById('score-popup').style.display = 'block';
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                    document.getElementById('applause-sound').play().catch(()=>{});
                }
            });
        });

        function sendData() {
            if (currentConn && currentConn.open) {
                const imgData = canvas.toDataURL('image/jpeg', 0.4); 
                currentConn.send({ img: imgData, char: miniPreview.innerText });
                alert("‡∏™‡πà‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
            } else { alert("‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏ï‡∏£‡∏ß‡∏à!"); }
        }

        // Initialize Canvas
        function initCanvas() { 
            canvas.width = window.innerWidth - 250; 
            canvas.height = window.innerHeight; 
            ctx.fillStyle = "white"; 
            ctx.fillRect(0, 0, canvas.width, canvas.height); 
            saveState(); 
        }
        window.onresize = initCanvas; window.onload = initCanvas;

        // ‡∏Ñ‡∏•‡∏±‡∏á‡∏£‡∏π‡∏õ 50 ‡∏£‡∏π‡∏õ (‡∏™‡∏±‡∏ï‡∏ß‡πå + ‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ)
        const items = ["üê∂","üê±","üê≠","üêπ","üê∞","ü¶ä","üêª","üêº","üê®","üêØ","ü¶Å","üêÆ","üê∑","üê∏","üêµ","üêî","üêß","üê¶","üê§","ü¶Ü","ü¶Ö","ü¶â","üê¥","ü¶Ñ","üê¢","üå∏","üåª","üåπ","üå∑","üåº","üå∫","üçÄ","üåø","üåµ","üéÑ","üéã","üçÉ","üçÇ","üçÅ","üçÑ","üåæ","üíê","üèµÔ∏è","ü•Ä","üíÆ","ü™¥","üåµ","üçÄ","ü™¥","üåª"];
        const lib = document.getElementById('template-library');
        items.forEach(t => {
            const el = document.createElement('div'); el.className = 'lib-item'; el.innerText = t;
            el.onclick = () => {
                templateOverlay.innerText = t; // ‡πÅ‡∏™‡∏î‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á (‡∏à‡∏≤‡∏á‡πÜ)
                miniPreview.innerText = t;    // ‡πÅ‡∏™‡∏î‡∏á‡∏ó‡∏µ‡πà‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏°‡∏∏‡∏°‡∏à‡∏≠
            };
            lib.appendChild(el);
        });

        const colors = ['#000000','#ffffff','#ff0000','#00ff00','#0000ff','#ffff00','#ff00ff','#00ffff','#ff9900','#663300'];
        colors.forEach(c => {
            const div = document.createElement('div'); div.className = 'color-dot'; div.style.background = c;
            div.onclick = () => { currentColor = c; document.querySelectorAll('.color-dot').forEach(d=>d.style.borderColor='transparent'); div.style.borderColor = 'white'; };
            document.getElementById('color-bar').appendChild(div);
        });

        function setMode(m, btn) { mode = m; document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active')); btn.classList.add('active'); }
        
        canvas.onpointerdown = (e) => { 
            drawing = true; 
            ctx.beginPath(); 
            ctx.moveTo(e.offsetX, e.offsetY); 
            ctx.strokeStyle = mode === 'eraser' ? 'white' : currentColor; 
            ctx.lineWidth = document.getElementById('brush-size').value; 
            ctx.lineCap = 'round'; ctx.lineJoin = 'round'; 
        };
        canvas.onpointermove = (e) => { if(drawing) { ctx.lineTo(e.offsetX, e.offsetY); ctx.stroke(); } };
        canvas.onpointerup = () => { if(drawing) { drawing = false; saveState(); } };
        
        function clearCanvas() { ctx.fillStyle = "white"; ctx.fillRect(0, 0, canvas.width, canvas.height); saveState(); }
        function saveState() { undoStack.push(ctx.getImageData(0,0,canvas.width,canvas.height)); if(undoStack.length > 20) undoStack.shift(); }
        function undo() { if(undoStack.length > 1) { undoStack.pop(); ctx.putImageData(undoStack[undoStack.length-1], 0,0); } }
    </script>
</body>
</html>
