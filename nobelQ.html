<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏ó‡∏≤‡∏¢‡πÑ‡∏õ‡∏ß‡∏±‡∏ô‡πÜ ‡∏Å‡∏±‡∏ö‡πÇ‡∏ô‡πÄ‡∏ö‡∏• - By ‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;800&display=swap');
        body { font-family: 'Kanit', sans-serif; overflow: hidden; position: fixed; width: 100%; height: 100%; }
        
        #canvas-wrapper { position: relative; width: 100%; height: calc(100vh - 300px); background: #fff; border-radius: 2rem; overflow: hidden; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); }
        canvas { width: 100% !important; height: 100% !important; touch-action: none; cursor: crosshair; }
        
        #image-wrapper { width: 100%; height: calc(100vh - 320px); display: flex; align-items: center; justify-content: center; background: #fff; border-radius: 2rem; }
        #received-image { max-width: 100%; max-height: 100%; object-fit: contain; }

        .hidden { display: none; }
        .gradient-bg { background: linear-gradient(135deg, #4f46e5 0%, #9333ea 100%); }
        
        .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .color-dot.active { border-color: #4f46e5; transform: scale(1.2); }
        
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        optgroup { font-weight: bold; color: #4f46e5; background: #f8fafc; }
    </style>
</head>
<body class="bg-slate-50">

    <div id="main-card" class="h-screen w-screen flex flex-col bg-white overflow-hidden relative">
        <div class="gradient-bg p-4 text-white text-center shadow-lg">
            <h1 class="text-xl font-black tracking-tighter uppercase">‡∏ó‡∏≤‡∏¢‡πÑ‡∏õ‡∏ß‡∏±‡∏ô‡πÜ ‡∏Å‡∏±‡∏ö‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</h1>
            <p class="text-[10px] font-light opacity-80" id="status-display">By-‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</p>
        </div>

        <div class="flex-1 p-4 flex flex-col overflow-hidden">
            <div id="setup-section" class="my-auto space-y-8 animate__animated animate__fadeIn">
                <div class="space-y-3 text-center">
                    <label class="block text-sm font-bold text-slate-400 uppercase tracking-widest">‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡∏•‡∏±‡∏ö</label>
                    <input type="number" id="room-code" placeholder="0000" 
                        class="w-3/4 p-5 bg-slate-50 border-2 border-slate-100 rounded-3xl text-4xl font-black text-center focus:border-indigo-500 focus:bg-white outline-none transition-all shadow-inner">
                </div>
                <div class="grid grid-cols-1 gap-4 px-6">
                    <button onclick="initPeer('drawer')" class="bg-indigo-600 text-white font-bold py-5 rounded-3xl shadow-xl hover:bg-indigo-700 active:scale-95 transition-all text-xl">‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏ß‡∏≤‡∏î</button>
                    <button onclick="initPeer('guesser')" class="bg-white border-2 border-indigo-100 text-indigo-600 font-bold py-5 rounded-3xl hover:bg-slate-50 active:scale-95 transition-all text-xl">‡∏â‡∏±‡∏ô‡∏à‡∏∞‡∏ó‡∏≤‡∏¢</button>
                </div>
            </div>

            <div id="drawer-section" class="hidden h-full flex flex-col space-y-3">
                <div class="flex items-center justify-between bg-indigo-50 p-3 rounded-2xl border border-indigo-100">
                    <select id="target-word" class="bg-transparent font-black text-indigo-700 text-lg outline-none flex-1 mr-2"></select>
                    <div id="drawer-feedback" class="px-3 py-1 rounded-full bg-white text-slate-400 text-[10px] font-bold uppercase shadow-sm shrink-0">‡∏£‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏¢‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...</div>
                </div>

                <div class="flex items-center justify-between bg-white p-2 rounded-2xl shadow-sm border border-slate-100">
                    <div class="flex gap-2">
                        <div class="color-dot active bg-black" onclick="setColor('#000000', this)"></div>
                        <div class="color-dot bg-red-500" onclick="setColor('#ef4444', this)"></div >
                        <div class="color-dot bg-blue-500" onclick="setColor('#3b82f6', this)"></div>
                        <div class="color-dot bg-green-500" onclick="setColor('#22c55e', this)"></div>
                        <button onclick="setEraser(this)" class="w-[30px] h-[30px] bg-slate-100 rounded-full flex items-center justify-center text-[14px] border-2 border-transparent" id="eraser-btn">üßΩ</button>
                    </div>
                    <div class="flex items-center gap-2">
                        <span class="text-[10px] font-bold text-slate-400">‡∏Ç‡∏ô‡∏≤‡∏î:</span>
                        <select id="brush-size" class="bg-slate-100 rounded-lg text-xs font-bold p-1 outline-none" onchange="setSize(this.value)">
                            <option value="4">‡πÄ‡∏•‡πá‡∏Å</option>
                            <option value="8" selected>‡∏Å‡∏•‡∏≤‡∏á</option>
                            <option value="16">‡πÉ‡∏´‡∏ç‡πà</option>
                        </select>
                    </div>
                </div>

                <div id="canvas-wrapper" class="border-4 border-slate-100">
                    <canvas id="paintCanvas"></canvas>
                </div>
                <div class="grid grid-cols-2 gap-3 pb-2">
                    <button onclick="clearCanvas()" class="bg-slate-100 text-slate-500 font-bold py-4 rounded-2xl">‡∏•‡πâ‡∏≤‡∏á</button>
                    <button id="send-btn" onclick="sendData()" class="bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg active:scale-95 transition-all">‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡πÉ‡∏´‡πâ‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏¢</button>
                </div>
            </div>

            <div id="guesser-section" class="hidden h-full flex flex-col space-y-3 text-center">
                <div id="image-wrapper" class="relative border-4 border-slate-100 p-2 shadow-inner">
                    <img id="received-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
                    <div id="wait-msg" class="absolute inset-0 flex items-center justify-center text-slate-300 font-bold animate-pulse">‡∏£‡∏≠‡∏Ñ‡∏ô‡∏ß‡∏≤‡∏î‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û...</div>
                </div>
                <div id="answer-buttons" class="grid grid-cols-2 gap-3 flex-1 pt-2 pb-2 no-scrollbar overflow-hidden"></div>
            </div>
        </div>

        <div class="text-center p-2 border-t border-slate-50">
             <p class="text-xs font-black text-slate-300">‡∏ó‡∏≤‡∏¢‡πÑ‡∏õ‡∏ß‡∏±‡∏ô‡πÜ ‡∏Å‡∏±‡∏ö‡πÇ‡∏ô‡πÄ‡∏ö‡∏• - By-‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</p>
        </div>
    </div>

    <script>
        const wordBank = {
            "‡∏™‡∏±‡∏ï‡∏ß‡πå üêæ": ["‡∏´‡∏°‡∏µ üêª", "‡πÄ‡∏™‡∏∑‡∏≠ üêØ", "‡∏Å‡∏£‡∏∞‡∏ï‡πà‡∏≤‡∏¢ üê∞", "‡πÅ‡∏°‡∏ß üê±", "‡∏™‡∏∏‡∏ô‡∏±‡∏Ç üê∂", "‡∏ä‡πâ‡∏≤‡∏á üêò", "‡∏°‡πâ‡∏≤ üê¥", "‡∏•‡∏¥‡∏á üêí", "‡πÑ‡∏Å‡πà üêî", "‡πÄ‡∏õ‡πá‡∏î ü¶Ü", "‡∏´‡∏°‡∏π üê∑", "‡∏ß‡∏±‡∏ß üêÆ", "‡∏á‡∏π üêç", "‡∏ô‡∏Å üê¶", "‡πÅ‡∏û‡∏ô‡∏î‡πâ‡∏≤ üêº", "‡∏™‡∏¥‡∏á‡πÇ‡∏ï ü¶Å"],
            "‡∏Ç‡∏≠‡∏á‡∏Å‡∏¥‡∏ô üçé": ["‡πÅ‡∏≠‡∏õ‡πÄ‡∏õ‡∏¥‡πâ‡∏• üçé", "‡∏Å‡∏•‡πâ‡∏ß‡∏¢ üçå", "‡∏û‡∏¥‡∏ã‡∏ã‡πà‡∏≤ üçï", "‡πÄ‡∏Ñ‡πâ‡∏Å üç∞", "‡πÇ‡∏î‡∏ô‡∏±‡∏ó üç©", "‡πÑ‡∏Ç‡πà‡∏î‡∏≤‡∏ß üç≥"],
            "‡∏™‡∏¥‡πà‡∏á‡∏Ç‡∏≠‡∏á üè†": ["‡∏ö‡πâ‡∏≤‡∏ô üè†", "‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå üöó", "‡∏à‡∏±‡∏Å‡∏£‡∏¢‡∏≤‡∏ô üö≤", "‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå üì±", "‡∏£‡πà‡∏° ‚òÇÔ∏è", "‡πÅ‡∏ß‡πà‡∏ô‡∏ï‡∏≤ üëì", "‡∏•‡∏π‡∏Å‡∏ö‡∏≠‡∏• ‚öΩ"],
            "‡∏ò‡∏£‡∏£‡∏°‡∏ä‡∏≤‡∏ï‡∏¥ üå≥": ["‡∏û‡∏£‡∏∞‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå ‚òÄÔ∏è", "‡∏û‡∏£‡∏∞‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå üåô", "‡∏™‡∏≤‡∏¢‡∏£‡∏∏‡πâ‡∏á üåà", "‡∏ó‡∏∞‡πÄ‡∏• üåä", "‡πÑ‡∏ü üî•"],
            "‡∏ï‡∏±‡∏ß‡∏≠‡∏±‡∏Å‡∏©‡∏£ üî°": ["A", "B", "C", "1", "2", "3", "‡∏Å", "‡∏Ç", "‡∏Ñ"]
        };

        const allWordsFlat = Object.values(wordBank).flat();
        const canvas = document.getElementById('paintCanvas');
        const ctx = canvas.getContext('2d');
        let painting = false;
        let currentBrushColor = '#000000';
        let currentBrushSize = 8;
        let isEraser = false;
        let peer, conn, myRole;

        function initPeer(role) {
            const roomCode = document.getElementById('room-code').value;
            if (!roomCode || roomCode.length < 3) return Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á 3 ‡∏´‡∏•‡∏±‡∏Å‡∏Ç‡∏∂‡πâ‡∏ô‡πÑ‡∏õ');
            
            myRole = role;
            const peerId = (role === 'drawer' ? 'NOBEL-D-' : 'NOBEL-G-') + roomCode;
            const targetId = (role === 'drawer' ? 'NOBEL-G-' : 'NOBEL-D-') + roomCode;

            peer = new Peer(peerId);

            peer.on('open', (id) => {
                document.getElementById('setup-section').classList.add('hidden');
                document.getElementById(role + '-section').classList.remove('hidden');
                document.getElementById('status-display').innerText = `‡∏´‡πâ‡∏≠‡∏á: ${roomCode} | ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${role === 'drawer' ? '‡∏Ñ‡∏ô‡∏ß‡∏≤‡∏î' : '‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏¢'}`;

                if (role === 'drawer') {
                    populateWordSelect();
                    setTimeout(resizeCanvas, 100);
                    peer.on('connection', (c) => {
                        conn = c;
                        setupConn();
                        document.getElementById('drawer-feedback').innerText = "‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏¢‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÅ‡∏•‡πâ‡∏ß! ‚úÖ";
                        document.getElementById('drawer-feedback').classList.add('text-green-600');
                    });
                } else {
                    conn = peer.connect(targetId);
                    setupConn();
                }
            });

            peer.on('error', (err) => {
                Swal.fire('‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß', '‡∏£‡∏´‡∏±‡∏™‡∏´‡πâ‡∏≠‡∏á‡∏≠‡∏≤‡∏à‡∏ã‡πâ‡∏≥‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏•‡∏≠‡∏á‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏£‡∏´‡∏±‡∏™‡∏î‡∏π‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö', 'error');
            });
        }

        function setupConn() {
            conn.on('data', (data) => {
                if (data.type === 'image') {
                    document.getElementById('received-image').src = data.img;
                    document.getElementById('wait-msg').classList.add('hidden');
                    createButtons(data.ans);
                } else if (data.type === 'result') {
                    if (data.status === 'correct') {
                        confetti({ particleCount: 150, spread: 100 });
                        Swal.fire('‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏¢‡∏ï‡∏≠‡∏ö‡∏ñ‡∏π‡∏Å!', `‡∏Ñ‡∏≥‡πÄ‡∏â‡∏•‡∏¢: ${data.ans}`, 'success');
                    } else {
                        Swal.fire({title: '‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏¢‡∏ï‡∏≠‡∏ö‡∏ú‡∏¥‡∏î!', icon: 'error', toast: true, position: 'top', timer: 2000});
                    }
                }
            });
        }

        function sendData() {
            if (!conn) return Swal.fire('‡∏£‡∏≠‡∏Ñ‡∏ô‡∏ó‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞‡∏Ñ‡∏£‡∏±‡∏ö');
            conn.send({
                type: 'image',
                img: canvas.toDataURL('image/png', 0.5),
                ans: document.getElementById('target-word').value
            });
            Swal.fire({ title: '‡∏™‡πà‡∏á‡∏†‡∏≤‡∏û‡πÅ‡∏•‡πâ‡∏ß!', icon: 'success', toast: true, position: 'top-end', timer: 1500 });
        }

        function createButtons(correct) {
            const container = document.getElementById('answer-buttons');
            container.innerHTML = "";
            let choices = allWordsFlat.filter(w => w !== correct).sort(() => 0.5 - Math.random()).slice(0, 3);
            choices.push(correct);
            choices.sort(() => 0.5 - Math.random());

            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = "bg-slate-50 border-2 border-slate-100 h-full rounded-3xl font-black text-lg text-slate-600 active:scale-95 transition-all";
                btn.innerText = choice;
                btn.onclick = () => {
                    if (choice === correct) {
                        confetti({ particleCount: 150, spread: 100 });
                        Swal.fire('‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á!', '', 'success');
                        conn.send({ type: 'result', status: 'correct', ans: correct });
                    } else {
                        document.getElementById('main-card').classList.add('shake');
                        setTimeout(() => document.getElementById('main-card').classList.remove('shake'), 500);
                        conn.send({ type: 'result', status: 'wrong' });
                    }
                };
                container.appendChild(btn);
            });
        }

        // Drawing Functions
        function resizeCanvas() {
            const wrapper = document.getElementById('canvas-wrapper');
            if (wrapper) {
                canvas.width = wrapper.clientWidth;
                canvas.height = wrapper.clientHeight;
                ctx.lineCap = 'round';
            }
        }
        window.addEventListener('resize', resizeCanvas);

        function setColor(color, el) {
            isEraser = false;
            currentBrushColor = color;
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
            document.getElementById('eraser-btn').classList.remove('active', 'border-indigo-500');
            el.classList.add('active');
        }

        function setEraser(el) {
            isEraser = true;
            document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active'));
            el.classList.add('active', 'border-indigo-500');
        }

        function setSize(size) { currentBrushSize = size; }

        function getCoords(e) {
            const rect = canvas.getBoundingClientRect();
            const clientX = e.touches ? e.touches[0].clientX : e.clientX;
            const clientY = e.touches ? e.touches[0].clientY : e.clientY;
            return { x: clientX - rect.left, y: clientY - rect.top };
        }

        function startPainting(e) { painting = true; draw(e); }
        function stopPainting() { painting = false; ctx.beginPath(); }

        function draw(e) {
            if (!painting) return;
            const coords = getCoords(e);
            ctx.lineWidth = currentBrushSize;
            ctx.lineCap = 'round';
            ctx.globalCompositeOperation = isEraser ? 'destination-out' : 'source-over';
            ctx.strokeStyle = currentBrushColor;
            ctx.lineTo(coords.x, coords.y);
            ctx.stroke();
            ctx.beginPath();
            ctx.moveTo(coords.x, coords.y);
        }

        canvas.addEventListener('mousedown', startPainting);
        canvas.addEventListener('mouseup', stopPainting);
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); startPainting(e); });
        canvas.addEventListener('touchend', stopPainting);
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });

        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }

        function populateWordSelect() {
            const select = document.getElementById('target-word');
            select.innerHTML = "";
            for (const [category, words] of Object.entries(wordBank)) {
                const group = document.createElement('optgroup');
                group.label = category;
                words.forEach(word => {
                    const opt = document.createElement('option');
                    opt.value = word;
                    opt.innerText = word;
                    group.appendChild(opt);
                });
                select.appendChild(group);
            }
        }
    </script>
</body>
</html>
