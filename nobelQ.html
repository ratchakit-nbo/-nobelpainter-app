<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>à¸—à¸²à¸¢à¹„à¸›à¸§à¸±à¸™à¹† à¸à¸±à¸šà¹‚à¸™à¹€à¸šà¸¥ - By à¸à¹ˆà¸­à¹‚à¸™à¹€à¸šà¸¥</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;500;800&display=swap');
        body { font-family: 'Kanit', sans-serif; overflow: hidden; position: fixed; width: 100%; height: 100%; }
        #canvas-wrapper { position: relative; width: 100%; height: calc(100vh - 300px); background: #fff; border-radius: 2rem; overflow: hidden; box-shadow: inset 0 0 10px rgba(0,0,0,0.1); }
        canvas { width: 100% !important; height: 100% !important; touch-action: none; cursor: crosshair; }
        #image-wrapper { width: 100%; height: calc(100vh - 320px); display: flex; align-items: center; justify-content: center; background: #fff; border-radius: 2rem; }
        #received-image { max-width: 100%; max-height: 100%; object-fit: contain; }
        .hidden { display: none; }
        .gradient-bg { background: linear-gradient(135deg, #4f46e5 0%, #9333ea 100%); }
        .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid transparent; transition: 0.2s; }
        .color-dot.active { border-color: #4f46e5; transform: scale(1.2); }
        .shake { animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-slate-50">

    <div id="main-card" class="h-screen w-screen flex flex-col bg-white overflow-hidden relative">
        <div class="gradient-bg p-4 text-white text-center shadow-lg">
            <h1 class="text-xl font-black tracking-tighter uppercase">à¸—à¸²à¸¢à¹„à¸›à¸§à¸±à¸™à¹† à¸à¸±à¸šà¹‚à¸™à¹€à¸šà¸¥</h1>
            <p class="text-[10px] font-light opacity-80" id="status-display">By-à¸à¹ˆà¸­à¹‚à¸™à¹€à¸šà¸¥ (à¸£à¸­à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­...)</p>
        </div>

        <div class="flex-1 p-4 flex flex-col overflow-hidden">
            <div id="setup-section" class="my-auto space-y-8 animate__animated animate__fadeIn">
                <div class="space-y-3 text-center">
                    <label class="block text-sm font-bold text-slate-400 uppercase tracking-widest">à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¸«à¹‰à¸­à¸‡ (à¹€à¸¥à¸‚ 4 à¸«à¸¥à¸±à¸)</label>
                    <input type="number" id="room-code" placeholder="0000" class="w-3/4 p-5 bg-slate-50 border-2 border-slate-100 rounded-3xl text-4xl font-black text-center focus:border-indigo-500 focus:bg-white outline-none transition-all shadow-inner">
                </div>
                <div class="grid grid-cols-1 gap-4 px-6">
                    <button onclick="initPeer('drawer')" class="bg-indigo-600 text-white font-bold py-5 rounded-3xl shadow-xl active:scale-95 text-xl">à¸‰à¸±à¸™à¸ˆà¸°à¸§à¸²à¸”</button>
                    <button onclick="initPeer('guesser')" class="bg-white border-2 border-indigo-100 text-indigo-600 font-bold py-5 rounded-3xl active:scale-95 text-xl">à¸‰à¸±à¸™à¸ˆà¸°à¸—à¸²à¸¢</button>
                </div>
            </div>

            <div id="drawer-section" class="hidden h-full flex flex-col space-y-3">
                <div class="flex items-center justify-between bg-indigo-50 p-3 rounded-2xl border border-indigo-100">
                    <select id="target-word" class="bg-transparent font-black text-indigo-700 text-lg outline-none flex-1 mr-2"></select>
                    <div id="drawer-feedback" class="px-3 py-1 rounded-full bg-white text-slate-400 text-[10px] font-bold uppercase shadow-sm">à¸ªà¸–à¸²à¸™à¸°: à¸£à¸­à¸„à¸™à¸—à¸²à¸¢</div>
                </div>
                <div class="flex items-center justify-between bg-white p-2 rounded-2xl shadow-sm border border-slate-100">
                    <div class="flex gap-2">
                        <div class="color-dot active bg-black" onclick="setColor('#000000', this)"></div>
                        <div class="color-dot bg-red-500" onclick="setColor('#ef4444', this)"></div>
                        <div class="color-dot bg-blue-500" onclick="setColor('#3b82f6', this)"></div>
                        <div class="color-dot bg-green-500" onclick="setColor('#22c55e', this)"></div>
                        <button onclick="setEraser(this)" class="w-[30px] h-[30px] bg-slate-100 rounded-full flex items-center justify-center text-[14px]" id="eraser-btn">ğŸ§½</button>
                    </div>
                    <select onchange="setSize(this.value)" class="bg-slate-100 rounded-lg text-xs font-bold p-1 outline-none">
                        <option value="4">à¹€à¸¥à¹‡à¸</option>
                        <option value="8" selected>à¸à¸¥à¸²à¸‡</option>
                        <option value="16">à¹ƒà¸«à¸à¹ˆ</option>
                    </select>
                </div>
                <div id="canvas-wrapper" class="border-4 border-slate-100"><canvas id="paintCanvas"></canvas></div>
                <div class="grid grid-cols-2 gap-3 pb-2">
                    <button onclick="clearCanvas()" class="bg-slate-100 text-slate-500 font-bold py-4 rounded-2xl">à¸¥à¹‰à¸²à¸‡</button>
                    <button onclick="sendData()" class="bg-indigo-600 text-white font-bold py-4 rounded-2xl shadow-lg">à¸ªà¹ˆà¸‡à¸ à¸²à¸à¹„à¸›à¹ƒà¸«à¹‰à¸—à¸²à¸¢</button>
                </div>
            </div>

            <div id="guesser-section" class="hidden h-full flex flex-col space-y-3 text-center">
                <div id="image-wrapper" class="relative border-4 border-slate-100 p-2 shadow-inner">
                    <img id="received-image" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7">
                    <div id="wait-msg" class="absolute inset-0 flex items-center justify-center text-slate-300 font-bold animate-pulse">à¸£à¸­à¸„à¸™à¸§à¸²à¸”à¸ªà¹ˆà¸‡à¸ à¸²à¸...</div>
                </div>
                <div id="answer-buttons" class="grid grid-cols-2 gap-3 flex-1 pt-2 pb-2 no-scrollbar overflow-hidden"></div>
            </div>
        </div>
        <div class="text-center p-2 border-t border-slate-50">
             <p class="text-xs font-black text-slate-300">à¸—à¸²à¸¢à¹„à¸›à¸§à¸±à¸™à¹† à¸à¸±à¸šà¹‚à¸™à¹€à¸šà¸¥ - By-à¸à¹ˆà¸­à¹‚à¸™à¹€à¸šà¸¥</p>
        </div>
    </div>

    <script>
        const wordBank = {
            "à¸ªà¸±à¸•à¸§à¹Œ ğŸ¾": ["à¸«à¸¡à¸µ ğŸ»", "à¹€à¸ªà¸·à¸­ ğŸ¯", "à¸à¸£à¸°à¸•à¹ˆà¸²à¸¢ ğŸ°", "à¹à¸¡à¸§ ğŸ±", "à¸ªà¸¸à¸™à¸±à¸‚ ğŸ¶", "à¸Šà¹‰à¸²à¸‡ ğŸ˜", "à¸¡à¹‰à¸² ğŸ´", "à¸¥à¸´à¸‡ ğŸ’", "à¹„à¸à¹ˆ ğŸ”", "à¹€à¸›à¹‡à¸” ğŸ¦†", "à¸«à¸¡à¸¹ ğŸ·", "à¸§à¸±à¸§ ğŸ®", "à¸‡à¸¹ ğŸ", "à¸ˆà¸£à¸°à¹€à¸‚à¹‰ ğŸŠ", "à¹€à¸•à¹ˆà¸² ğŸ¢", "à¸›à¸¥à¸² ğŸŸ", "à¸à¸¸à¹‰à¸‡ ğŸ¦", "à¸›à¸¹ ğŸ¦€", "à¸™à¸ ğŸ¦", "à¸œà¸µà¹€à¸ªà¸·à¹‰à¸­ ğŸ¦‹", "à¸¡à¸” ğŸœ", "à¸œà¸¶à¹‰à¸‡ ğŸ", "à¸ªà¸´à¸‡à¹‚à¸• ğŸ¦", "à¸¢à¸µà¸£à¸²à¸Ÿ ğŸ¦’", "à¸„à¹‰à¸²à¸‡à¸„à¸²à¸§ ğŸ¦‡", "à¹à¸à¸™à¸”à¹‰à¸² ğŸ¼", "à¸à¸š ğŸ¸", "à¸«à¸™à¸¹ ğŸ­"],
            "à¸­à¸²à¸«à¸²à¸£ ğŸ": ["à¹à¸­à¸›à¹€à¸›à¸´à¹‰à¸¥ ğŸ", "à¸à¸¥à¹‰à¸§à¸¢ ğŸŒ", "à¸ªà¹‰à¸¡ ğŸŠ", "à¹à¸•à¸‡à¹‚à¸¡ ğŸ‰", "à¸—à¸¸à¹€à¸£à¸µà¸¢à¸™ ğŸˆ", "à¸à¸´à¸‹à¸‹à¹ˆà¸² ğŸ•", "à¹„à¸­à¸¨à¸à¸£à¸µà¸¡ ğŸ¦", "à¹€à¸„à¹‰à¸ ğŸ°"],
            "à¸ªà¸´à¹ˆà¸‡à¸‚à¸­à¸‡ ğŸ ": ["à¸šà¹‰à¸²à¸™ ğŸ ", "à¸£à¸–à¸¢à¸™à¸•à¹Œ ğŸš—", "à¸ˆà¸±à¸à¸£à¸¢à¸²à¸™ ğŸš²", "à¹‚à¸—à¸£à¸¨à¸±à¸à¸—à¹Œ ğŸ“±", "à¸„à¸­à¸¡à¸à¸´à¸§à¹€à¸•à¸­à¸£à¹Œ ğŸ’»", "à¸£à¹ˆà¸¡ â˜‚ï¸", "à¹à¸§à¹ˆà¸™à¸•à¸² ğŸ‘“", "à¸à¸µà¸•à¸²à¸£à¹Œ ğŸ¸"],
            "à¸˜à¸£à¸£à¸¡à¸Šà¸²à¸•à¸´ ğŸŒ³": ["à¸à¸£à¸°à¸­à¸²à¸—à¸´à¸•à¸¢à¹Œ â˜€ï¸", "à¸à¸£à¸°à¸ˆà¸±à¸™à¸—à¸£à¹Œ ğŸŒ™", "à¸”à¸§à¸‡à¸”à¸²à¸§ â­", "à¹€à¸¡à¸† â˜ï¸", "à¸•à¹‰à¸™à¹„à¸¡à¹‰ ğŸŒ³", "à¸ªà¸²à¸¢à¸£à¸¸à¹‰à¸‡ ğŸŒˆ", "à¸—à¸°à¹€à¸¥ ğŸŒŠ"],
            "à¸­à¸±à¸à¸©à¸£/à¹€à¸¥à¸‚ ğŸ”¡": ["A","B","C","1","2","3","à¸","à¸‚","à¸„"]
        };
        const allWordsFlat = Object.values(wordBank).flat();
        let peer, conn, myRole;
        const canvas = document.getElementById('paintCanvas');
        const ctx = canvas.getContext('2d');
        let painting = false, currentBrushColor = '#000000', currentBrushSize = 8, isEraser = false;

        function initPeer(role) {
            const code = document.getElementById('room-code').value;
            if (!code || code.length < 3) return Swal.fire('à¹ƒà¸ªà¹ˆà¸£à¸«à¸±à¸ªà¸«à¹‰à¸­à¸‡ 3 à¸«à¸¥à¸±à¸à¸‚à¸¶à¹‰à¸™à¹„à¸›');
            myRole = role;
            
            // à¸ªà¸£à¹‰à¸²à¸‡ ID à¸ˆà¸²à¸à¸£à¸«à¸±à¸ªà¸«à¹‰à¸­à¸‡ (à¸§à¸²à¸”=D+code, à¸—à¸²à¸¢=G+code)
            const peerId = (role === 'drawer' ? 'NOBEL-D-' : 'NOBEL-G-') + code;
            const targetId = (role === 'drawer' ? 'NOBEL-G-' : 'NOBEL-D-') + code;

            peer = new Peer(peerId);

            peer.on('open', (id) => {
                document.getElementById('setup-section').classList.add('hidden');
                document.getElementById(role + '-section').classList.remove('hidden');
                document.getElementById('status-display').innerText = `à¸«à¹‰à¸­à¸‡: ${code} | à¸„à¸¸à¸“à¸„à¸·à¸­: ${role === 'drawer' ? 'à¸„à¸™à¸§à¸²à¸”' : 'à¸„à¸™à¸—à¸²à¸¢'}`;
                
                if (role === 'drawer') {
                    populateWordSelect();
                    setTimeout(resizeCanvas, 100);
                    // à¸„à¸™à¸§à¸²à¸”à¸£à¸­à¸„à¸™à¸—à¸²à¸¢à¸¡à¸²à¸•à¹ˆà¸­
                    peer.on('connection', (c) => {
                        conn = c;
                        setupConn();
                        document.getElementById('drawer-feedback').innerText = "à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¹à¸¥à¹‰à¸§! âœ…";
                    });
                } else {
                    // à¸„à¸™à¸—à¸²à¸¢à¸—à¸±à¸à¹„à¸›à¸«à¸²à¸„à¸™à¸§à¸²à¸”
                    conn = peer.connect(targetId);
                    setupConn();
                }
            });

            peer.on('error', (err) => {
                Swal.fire('à¸à¸²à¸£à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­à¸œà¸´à¸”à¸à¸¥à¸²à¸”', 'à¸¥à¸­à¸‡à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹€à¸¥à¸‚à¸«à¹‰à¸­à¸‡à¹ƒà¸«à¸¡à¹ˆà¸™à¸°à¸„à¸£à¸±à¸š', 'error');
                location.reload();
            });
        }

        function setupConn() {
            conn.on('data', (data) => {
                if (data.type === 'image') {
                    document.getElementById('received-image').src = data.img;
                    document.getElementById('wait-msg').classList.add('hidden');
                    createButtons(data.ans);
                } else if (data.type === 'result') {
                    if (data.status === 'correct') {
                        confetti({ particleCount: 150, spread: 100 });
                        Swal.fire('à¸„à¸™à¸—à¸²à¸¢à¸•à¸­à¸šà¸–à¸¹à¸!', `à¸„à¸³à¸„à¸·à¸­: ${data.ans}`, 'success');
                    } else {
                        Swal.fire('à¸„à¸™à¸—à¸²à¸¢à¸•à¸­à¸šà¸œà¸´à¸”!', '', 'error');
                    }
                }
            });
        }

        function sendData() {
            if (!conn) return Swal.fire('à¸£à¸­à¸„à¸™à¸—à¸²à¸¢à¹€à¸‚à¹‰à¸²à¸«à¹‰à¸­à¸‡à¸à¹ˆà¸­à¸™à¸™à¸°à¸„à¸£à¸±à¸š');
            const data = {
                type: 'image',
                img: canvas.toDataURL('image/png', 0.5),
                ans: document.getElementById('target-word').value
            };
            conn.send(data);
            Swal.fire({ title: 'à¸ªà¹ˆà¸‡à¹„à¸›à¹à¸¥à¹‰à¸§!', icon: 'success', toast: true, position: 'top-end', timer: 1500 });
        }

        function createButtons(correct) {
            const container = document.getElementById('answer-buttons');
            container.innerHTML = "";
            let choices = allWordsFlat.filter(w => w !== correct).sort(() => 0.5 - Math.random()).slice(0, 3);
            choices.push(correct);
            choices.sort(() => 0.5 - Math.random());
            choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = "bg-slate-50 border-2 border-slate-100 h-full rounded-3xl font-black text-lg flex items-center justify-center active:scale-95";
                btn.innerText = choice;
                btn.onclick = () => {
                    if (choice === correct) {
                        confetti({ particleCount: 150, spread: 100 });
                        Swal.fire('à¸–à¸¹à¸à¸•à¹‰à¸­à¸‡!', '', 'success');
                        conn.send({ type: 'result', status: 'correct', ans: correct });
                    } else {
                        document.getElementById('main-card').classList.add('shake');
                        setTimeout(() => document.getElementById('main-card').classList.remove('shake'), 500);
                        conn.send({ type: 'result', status: 'wrong' });
                    }
                };
                container.appendChild(btn);
            });
        }

        // Canvas & UI Logic
        function setColor(c, el) { isEraser = false; currentBrushColor = c; document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active')); el.classList.add('active'); }
        function setEraser(el) { isEraser = true; document.querySelectorAll('.color-dot').forEach(d => d.classList.remove('active')); el.classList.add('active'); }
        function setSize(s) { currentBrushSize = s; }
        function resizeCanvas() { const w = document.getElementById('canvas-wrapper'); canvas.width = w.clientWidth; canvas.height = w.clientHeight; ctx.lineCap = 'round'; }
        function getCoords(e) { const r = canvas.getBoundingClientRect(); const x = e.touches ? e.touches[0].clientX : e.clientX; const y = e.touches ? e.touches[0].clientY : e.clientY; return { x: x - r.left, y: y - r.top }; }
        function draw(e) { if (!painting) return; const c = getCoords(e); ctx.lineWidth = currentBrushSize; ctx.globalCompositeOperation = isEraser ? 'destination-out' : 'source-over'; ctx.strokeStyle = currentBrushColor; ctx.lineTo(c.x, c.y); ctx.stroke(); ctx.beginPath(); ctx.moveTo(c.x, c.y); }
        canvas.addEventListener('mousedown', (e) => { painting = true; draw(e); });
        canvas.addEventListener('mouseup', () => { painting = false; ctx.beginPath(); });
        canvas.addEventListener('mousemove', draw);
        canvas.addEventListener('touchstart', (e) => { e.preventDefault(); painting = true; draw(e); });
        canvas.addEventListener('touchend', () => { painting = false; ctx.beginPath(); });
        canvas.addEventListener('touchmove', (e) => { e.preventDefault(); draw(e); });
        function clearCanvas() { ctx.clearRect(0, 0, canvas.width, canvas.height); }
        function populateWordSelect() { const s = document.getElementById('target-word'); s.innerHTML = ""; for (const [cat, words] of Object.entries(wordBank)) { const g = document.createElement('optgroup'); g.label = cat; words.forEach(w => { const o = document.createElement('option'); o.value = o.innerText = w; g.appendChild(o); }); s.appendChild(g); } }
    </script>
</body>
</html>
