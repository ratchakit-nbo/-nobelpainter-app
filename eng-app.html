<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏™‡∏ß‡∏ô‡∏Ñ‡∏≥‡∏®‡∏±‡∏û‡∏ó‡πå‡∏´‡∏£‡∏£‡∏©‡∏≤ BY ‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</title>
    <style>
        :root { 
            --sky-top: #a1e3ff;
            --sky-bottom: #e0f7fa;
            --grass-top: #8bc34a;
            --grass-bottom: #558b2f;
            --water-drop: #4fc3f7;
            --accent: #ffb74d;
        }
        
        * { box-sizing: border-box; touch-action: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            margin: 0; font-family: 'Segoe UI', Tahoma, sans-serif; background: #1a1a1a; 
            display: flex; justify-content: center; align-items: center; 
            height: 100dvh; overflow: hidden; 
        }

        #game-container {
            width: 100%; max-width: 480px; height: 100dvh;
            background: linear-gradient(to bottom, var(--sky-top) 0%, var(--sky-bottom) 50%, var(--grass-top) 50%, var(--grass-bottom) 100%);
            position: relative; overflow: hidden; display: flex; flex-direction: column;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }

        /* HUD */
        #hud {
            padding: 10px 15px; background: rgba(255, 255, 255, 0.2); 
            backdrop-filter: blur(10px); color: #2e7d32;
            display: flex; justify-content: space-between; font-weight: 800;
            z-index: 100; font-size: 14px; border-bottom: 1px solid rgba(255,255,255,0.3);
        }

        #garden-view { flex: 1.2; position: relative; width: 100%; }

        /* ‡∏™‡∏±‡∏ï‡∏ß‡πå‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà */
        .animal { 
            position: absolute; bottom: 10px; z-index: 10; 
            font-size: 40px; transition: left 3.5s ease-in-out, transform 0.3s;
            user-select: none; pointer-events: none;
        }

        /* ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏•‡∏≤‡∏Å‡∏ß‡∏≤‡∏á (‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏û‡∏≠‡∏î‡∏µ‡∏à‡∏≠) */
        #match-side {
            flex: 1; background: rgba(255, 255, 255, 0.85);
            padding: 10px; border-top: 5px solid #4e342e;
            display: grid; grid-template-columns: 1fr 1fr; gap: 8px; 
            overflow-y: auto; z-index: 10;
        }

        /* ‡∏´‡∏¢‡∏î‡∏ô‡πâ‡∏≥ */
        .word-item {
            position: absolute; width: 65px; height: 85px;
            background: linear-gradient(135deg, #4fc3f7, #0288d1); 
            color: white; border-radius: 0 50% 50% 50%; 
            transform: rotate(45deg); cursor: grab; font-weight: bold; 
            border: 2px solid rgba(255,255,255,0.8);
            box-shadow: 0 5px 10px rgba(0,0,0,0.2); z-index: 50; 
            display: flex; align-items: center; justify-content: center;
            touch-action: none;
        }
        .word-text { transform: rotate(-45deg); font-size: 12px; text-align: center; pointer-events: none; }

        .drop-zone {
            background: #fdfdfd; border: 2px solid #ddd; border-radius: 12px;
            padding: 5px; text-align: center; font-size: 13px; font-weight: bold; color: #555;
            display: flex; align-items: center; justify-content: center; height: 50px;
        }
        .drop-zone.matched { background: #81c784; color: white; border-color: transparent; }

        /* ‡∏õ‡∏∏‡πà‡∏°‡πÅ‡∏•‡∏∞‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï */
        .controls { padding: 15px; background: #33691e; display: flex; justify-content: center; z-index: 100; position: relative; }
        button {
            padding: 12px 40px; font-size: 16px; cursor: pointer; border-radius: 25px;
            border: none; background: linear-gradient(to bottom, #ffa726, #fb8c00); 
            color: white; font-weight: bold; box-shadow: 0 4px 0 #e65100;
        }
        .home-btn { position: absolute; bottom: 5px; left: 10px; font-size: 10px; color: #fff; text-decoration: none; opacity: 0.7; }
        #credit { position: absolute; bottom: 5px; right: 10px; font-size: 10px; color: #fff; opacity: 0.7; }

        /* ‡∏Ç‡∏≠‡∏á‡∏ï‡∏Å‡πÅ‡∏ï‡πà‡∏á */
        .sun { position: absolute; width: 50px; height: 50px; background: #ffeb3b; border-radius: 50%; top: 20px; right: 20px; box-shadow: 0 0 20px #ffeb3b; z-index: 1; }
        .garden-item { position: absolute; bottom: 0; z-index: 5; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="hud">
        <span>üå≥ LV <span id="lvl">1</span></span>
        <span>üêæ <span id="count">1</span></span>
        <span>üçé PROGRESS <span id="score">0</span>/5</span>
    </div>

    <div id="garden-view">
        <div class="sun"></div>
        <div id="garden-items-layer">
            <svg class="garden-item" id="main-tree" style="left:50%; transform:translateX(-50%);" width="100" height="130" viewBox="0 0 100 100">
                <rect x="42" y="70" width="16" height="30" fill="#5D4037" />
                <circle cx="50" cy="45" r="35" fill="#2E7D32" />
            </svg>
        </div>
        <div id="words-container"></div>
        <div id="animal-layer"></div>
    </div>

    <div id="match-side"></div>

    <div class="controls">
        <a href="https://ratchakit-nbo.github.io/-nobelpainter-app/game-nobel.html" class="home-btn">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        <button onclick="fetchRandomWord()">üíß ‡∏£‡∏î‡∏ô‡πâ‡∏≥‡πÉ‡∏ô‡∏™‡∏ß‡∏ô</button>
        <div id="credit">BY-‡∏û‡πà‡∏≠‡πÇ‡∏ô‡πÄ‡∏ö‡∏•</div>
    </div>
</div>

<script>
    let score = 0, level = 1, activeWords = [];
    let animals = [{emoji: 'üê∂', pos: 50}];
    const animalList = ['üê∂', 'üê±', 'üê∞', 'ü¶ä', 'üêª', 'üêº', 'üê®', 'üêØ', 'ü¶Å', 'üê∑', 'üê∏', 'üêµ'];

    function playAudio(en, th) {
        window.speechSynthesis.cancel();
        const msgEn = new SpeechSynthesisUtterance(en);
        msgEn.lang = 'en-US'; msgEn.onend = () => {
            const msgTh = new SpeechSynthesisUtterance(th);
            msgTh.lang = 'th-TH'; window.speechSynthesis.speak(msgTh);
        };
        window.speechSynthesis.speak(msgEn);
    }

    async function fetchRandomWord() {
        if (activeWords.length >= 6) return;
        try {
            const res = await fetch('https://api.datamuse.com/words?rel_jjb=nature&max=50');
            const data = await res.json();
            const word = data[Math.floor(Math.random() * data.length)].word.toUpperCase();
            const transRes = await fetch(`https://api.mymemory.translated.net/get?q=${word}&langpair=en|th`);
            const transData = await transRes.json();
            let th = transData.responseData.translatedText.split(/[ ,;]/)[0].substring(0, 12);
            createElements({ en: word, th: th, id: 'w' + Math.random().toString(36).substr(2, 5) });
        } catch (e) { console.log("API Error"); }
    }

    function createElements(obj) {
        activeWords.push(obj);
        const el = document.createElement('div');
        el.className = 'word-item'; el.id = obj.id;
        el.innerHTML = `<span class="word-text">${obj.en}</span>`;
        el.style.left = (Math.random() * 60 + 10) + '%';
        el.style.top = '10%';
        document.getElementById('words-container').appendChild(el);
        
        // Touch Drag Logic
        el.addEventListener('touchstart', handleTouchStart, {passive: false});
        el.addEventListener('touchmove', handleTouchMove, {passive: false});
        el.addEventListener('touchend', handleTouchEnd);

        const zone = document.createElement('div');
        zone.className = 'drop-zone'; zone.id = 'z' + obj.id; zone.innerText = obj.th;
        document.getElementById('match-side').appendChild(zone);

        setTimeout(() => { el.style.transition = "top 1.5s ease-out"; el.style.top = '70%'; }, 50);
    }

    let activeDrag = null;
    function handleTouchStart(e) { activeDrag = e.target; playAudio(activeWords.find(w=>w.id===e.target.id).en, ""); }
    function handleTouchMove(e) {
        if (!activeDrag) return;
        e.preventDefault();
        const touch = e.touches[0];
        activeDrag.style.transition = 'none';
        activeDrag.style.left = (touch.clientX - 32) + 'px';
        activeDrag.style.top = (touch.clientY - 42) + 'px';
    }
    function handleTouchEnd(e) {
        if (!activeDrag) return;
        const rect = activeDrag.getBoundingClientRect();
        const zone = document.getElementById('z' + activeDrag.id);
        const zoneRect = zone.getBoundingClientRect();

        if (rect.left < zoneRect.right && rect.right > zoneRect.left && rect.top < zoneRect.bottom && rect.bottom > zoneRect.top) {
            zone.className = 'drop-zone matched';
            zone.innerText = "‚úÖ " + activeWords.find(w=>w.id===activeDrag.id).en;
            activeDrag.remove();
            score++;
            document.getElementById('score').innerText = score;
            if (score >= 5) setTimeout(levelUp, 800);
        } else {
            activeDrag.style.transition = "top 0.5s"; activeDrag.style.top = '70%';
        }
        activeDrag = null;
    }

    function levelUp() {
        level++; score = 0;
        document.getElementById('match-side').innerHTML = '';
        document.getElementById('words-container').innerHTML = '';
        activeWords = [];
        animals.push({emoji: animalList[Math.floor(Math.random() * animalList.length)], pos: Math.random() * 80});
        if (level % 3 === 0) {
            const x = Math.random() * 80;
            document.getElementById('garden-items-layer').insertAdjacentHTML('beforeend', 
                `<span class="garden-item" style="left:${x}%; bottom:0; font-size:30px;">${Math.random()>0.5?'üå≥':'üå∏'}</span>`);
        }
        updateHUD();
    }

    function updateHUD() {
        document.getElementById('lvl').innerText = level;
        document.getElementById('count').innerText = animals.length;
        document.getElementById('score').innerText = score;
        const layer = document.getElementById('animal-layer');
        layer.innerHTML = '';
        animals.forEach((ani, i) => {
            const a = document.createElement('div');
            a.className = 'animal'; a.id = 'ani-'+i; a.innerText = ani.emoji;
            a.style.left = ani.pos + '%'; layer.appendChild(a);
        });
    }

    setInterval(() => {
        animals.forEach((ani, i) => {
            ani.pos = Math.max(5, Math.min(85, ani.pos + (Math.random() > 0.5 ? 15 : -15)));
            const el = document.getElementById('ani-' + i);
            if (el) { el.style.left = ani.pos + '%'; el.style.transform = `scaleX(${Math.random()>0.5?1:-1})`; }
        });
    }, 4000);

    updateHUD();
</script>
</body>
</html>
